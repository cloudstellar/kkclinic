# Sprint 5: Staff Workflow & Audit Trail

**Status:** Ready for Implementation  
**Date:** 2025-01-25  
**Depends on:** Sprint 4 (Adjustment), ADR-0003 (RBAC)

---

## ğŸ” Locked Design Decisions

### Tab Naming
| Tab | Label | Subtitle |
|-----|-------|----------|
| 1 | **à¸£à¸­à¸ªà¸£à¸¸à¸›à¹€à¸„à¸ª (N)** | - |
| 2 | **à¸£à¸­à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£ (N)** | `à¸£à¸­à¹€à¸à¹‡à¸šà¹€à¸‡à¸´à¸™ / à¸›à¸£à¸±à¸šà¸£à¸²à¸¢à¸à¸²à¸£` |

### Actions
- **à¸›à¸´à¸”à¸‡à¸²à¸™** button (train behavior, not enforce)
- Click entire card row â†’ go to receipt

### Layout
- Desktop: à¸‹à¹‰à¸²à¸¢-à¸‚à¸§à¸²
- Mobile: responsive stack

### Search
- Placeholder: `à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢à¸Šà¸·à¹ˆà¸­ / TN / à¹€à¸šà¸­à¸£à¹Œ`
- Auto-focus on page load

---

## Real World Flow (à¸—à¸µà¹ˆà¸£à¸°à¸šà¸šà¸—à¸³à¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§)

```
1. à¸«à¸¡à¸­à¸ªà¸£à¹‰à¸²à¸‡ Rx
2. à¸«à¸¡à¸­à¸à¸” "à¸ªà¸£à¸¸à¸›à¹€à¸„à¸ª" â†’ stock à¸•à¸±à¸”
3. Staff à¹€à¸«à¹‡à¸™à¹ƒà¸™à¹à¸—à¹‡à¸š "à¸£à¸­à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£"
4. Staff à¹€à¸à¹‡à¸šà¹€à¸‡à¸´à¸™ / adjust / à¸à¸´à¸¡à¸à¹Œ
5. Staff à¸à¸” "à¸›à¸´à¸”à¸‡à¸²à¸™"
```

---

## Phase 1: Done (Sprint 4.5) âœ…

- [x] Adjust â†’ dropdown menu
- [x] Void = Admin/Doctor only (UI + server)

---

## Phase 2: `/frontdesk` Route

### 2.1 Create `/frontdesk`

**File:** `app/(dashboard)/frontdesk/page.tsx`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” à¸„à¹‰à¸™à¸«à¸²à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢  â”‚  ğŸ“‹ à¸‡à¸²à¸™à¸§à¸±à¸™à¸™à¸µà¹‰                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  [à¸„à¹‰à¸™à¸«à¸² TN/à¸Šà¸·à¹ˆà¸­]  â”‚  â”‚à¸£à¸­à¸ªà¸£à¸¸à¸›à¹€à¸„à¸ª(3)â”‚à¸£à¸­à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£(12)â”‚ â”‚
â”‚                  â”‚  â”‚             â”‚à¸£à¸­à¹€à¸à¹‡à¸šà¹€à¸‡à¸´à¸™/à¸›à¸£à¸±à¸šâ”‚ â”‚
â”‚  â• à¹€à¸à¸´à¹ˆà¸¡à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                                 â”‚
â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                  â”‚  â”‚ à¸™à¸²à¸‡ à¸ªà¸¡à¸¨à¸£à¸µ à¹ƒà¸ˆà¸”à¸µ    à¸¿1,500   â”‚ â”‚
â”‚                  â”‚  â”‚ 09:30 à¸™.         [à¸›à¸´à¸”à¸‡à¸²à¸™]  â”‚ â”‚
â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Est:** 2.5h

### 2.2 Guard 3 à¸Šà¸±à¹‰à¸™

| Layer | File | Action |
|-------|------|--------|
| Route | `billing/page.tsx` | `if (staff) redirect('/frontdesk')` |
| Nav | `nav/menu` | à¸‹à¹ˆà¸­à¸™à¹€à¸¡à¸™à¸¹ billing |
| Default | Login redirect | Staff â†’ `/frontdesk` |

**Est:** 45m

---

## Phase 3: Rx History (MVP)

**File:** `app/(dashboard)/prescriptions/[id]/page.tsx`

Merge 3 data sources â†’ timeline:
- `transaction.created_at` â†’ à¸ªà¸£à¸¸à¸›à¹€à¸„à¸ª
- `transaction_adjustments` â†’ à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡ #N  
- `voided_at` â†’ à¸¢à¸à¹€à¸¥à¸´à¸

**Est:** 1.5h

---

## Implementation Order

| # | Task | Est | Status |
|---|------|-----|--------|
| 1 | Guard 3 à¸Šà¸±à¹‰à¸™ | 45m | â¬œ |
| 2 | Create `/frontdesk` | 2.5h | â¬œ |
| 3 | Rx history (MVP) | 1.5h | â¬œ |

**Total:** ~5h

---

## Acceptance Criteria

### RBAC
- [ ] Staff à¹€à¸‚à¹‰à¸² `/billing` â†’ redirect `/frontdesk`
- [ ] Staff à¹„à¸¡à¹ˆà¹€à¸«à¹‡à¸™à¹€à¸¡à¸™à¸¹ `/billing`
- [ ] Staff void à¹„à¸¡à¹ˆà¹„à¸”à¹‰ âœ…

### `/frontdesk`
- [ ] Tab "à¸£à¸­à¸ªà¸£à¸¸à¸›à¹€à¸„à¸ª" = Rx à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸¡à¸µ transaction
- [ ] Tab "à¸£à¸­à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£" = transactions à¸§à¸±à¸™à¸™à¸µà¹‰ + void badge
- [ ] à¸›à¸¸à¹ˆà¸¡ "à¸›à¸´à¸”à¸‡à¸²à¸™" works
- [ ] Click card â†’ receipt page
- [ ] Search: à¸Šà¸·à¹ˆà¸­ / TN / à¹€à¸šà¸­à¸£à¹Œ
- [ ] Responsive layout

### Rx History
- [ ] Timeline: created â†’ adjusted â†’ voided
- [ ] Empty state if no history

---

## Sprint 5 Complete = Ready for UAT
